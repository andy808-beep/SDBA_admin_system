<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TN Config Guarantee Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-section { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
    .success { background-color: #d4edda; border-color: #c3e6cb; }
    .error { background-color: #f8d7da; border-color: #f5c6cb; }
    .info { background-color: #d1ecf1; border-color: #bee5eb; }
  </style>
</head>
<body>
  <h1>TN Config Guarantee Test</h1>
  <div id="status">Testing TN config guarantee...</div>
  
  <div class="test-section" id="test1">
    <h3>Test 1: Database Config Loading</h3>
    <div id="test1-result">Testing...</div>
  </div>
  
  <div class="test-section" id="test2">
    <h3>Test 2: Fallback Config Creation</h3>
    <div id="test2-result">Testing...</div>
  </div>
  
  <div class="test-section" id="test3">
    <h3>Test 3: Console Assertion</h3>
    <div id="test3-result">Testing...</div>
  </div>
  
  <div class="test-section" id="test4">
    <h3>Test 4: Config Verification</h3>
    <div id="test4-result">Testing...</div>
  </div>
  
  <script src="env.js"></script>
  <script type="module">
    import { createTNConfig } from './js/event_bootstrap.js';
    import { loadEventConfig } from './js/config_loader.js';
    
    async function testDatabaseConfig() {
      try {
        console.log('üß™ Test 1: Testing database config loading...');
        const dbConfig = await loadEventConfig('tn', { useCache: true });
        
        if (dbConfig && dbConfig.event) {
          document.getElementById('test1-result').innerHTML = '‚úÖ Database config loaded successfully';
          document.getElementById('test1').className = 'test-section success';
          return true;
        } else {
          document.getElementById('test1-result').innerHTML = '‚ö†Ô∏è No database config found (expected for TN)';
          document.getElementById('test1').className = 'test-section info';
          return false;
        }
      } catch (error) {
        document.getElementById('test1-result').innerHTML = `‚ö†Ô∏è Database config failed: ${error.message}`;
        document.getElementById('test1').className = 'test-section info';
        return false;
      }
    }
    
    function testFallbackConfig() {
      try {
        console.log('üß™ Test 2: Testing fallback config creation...');
        
        // Clear any existing config
        window.__CONFIG = null;
        
        // Create fallback config
        createTNConfig();
        
        if (window.__CONFIG && window.__CONFIG.event) {
          document.getElementById('test2-result').innerHTML = '‚úÖ Fallback config created successfully';
          document.getElementById('test2').className = 'test-section success';
          return true;
        } else {
          document.getElementById('test2-result').innerHTML = '‚ùå Fallback config creation failed';
          document.getElementById('test2').className = 'test-section error';
          return false;
        }
      } catch (error) {
        document.getElementById('test2-result').innerHTML = `‚ùå Fallback config error: ${error.message}`;
        document.getElementById('test2').className = 'test-section error';
        return false;
      }
    }
    
    function testConsoleAssert() {
      try {
        console.log('üß™ Test 3: Testing console assertion...');
        
        // Test with valid config
        window.__CONFIG = { event: { event_short_ref: 'tn' } };
        console.assert(window.__CONFIG && window.__CONFIG.event, 'TN config missing');
        
        document.getElementById('test3-result').innerHTML = '‚úÖ Console assertion passed with valid config';
        document.getElementById('test3').className = 'test-section success';
        return true;
      } catch (error) {
        document.getElementById('test3-result').innerHTML = `‚ùå Console assertion failed: ${error.message}`;
        document.getElementById('test3').className = 'test-section error';
        return false;
      }
    }
    
    function testConfigVerification() {
      try {
        console.log('üß™ Test 4: Testing config verification...');
        
        // Test config verification logic
        if (window.__CONFIG && window.__CONFIG.event) {
          document.getElementById('test4-result').innerHTML = '‚úÖ Config verification passed';
          document.getElementById('test4').className = 'test-section success';
          return true;
        } else {
          document.getElementById('test4-result').innerHTML = '‚ùå Config verification failed';
          document.getElementById('test4').className = 'test-section error';
          return false;
        }
      } catch (error) {
        document.getElementById('test4-result').innerHTML = `‚ùå Config verification error: ${error.message}`;
        document.getElementById('test4').className = 'test-section error';
        return false;
      }
    }
    
    async function runAllTests() {
      console.log('üß™ Starting TN Config Guarantee Tests...');
      
      const test1Result = await testDatabaseConfig();
      const test2Result = testFallbackConfig();
      const test3Result = testConsoleAssert();
      const test4Result = testConfigVerification();
      
      const allPassed = test1Result || test2Result; // Either DB or fallback should work
      const configTestsPassed = test3Result && test4Result;
      
      if (allPassed && configTestsPassed) {
        document.getElementById('status').innerHTML = '‚úÖ All TN config guarantee tests passed!';
        document.getElementById('status').style.color = 'green';
      } else {
        document.getElementById('status').innerHTML = '‚ùå Some tests failed. Check individual test results.';
        document.getElementById('status').style.color = 'red';
      }
      
      console.log('üß™ TN Config Guarantee Tests completed');
    }
    
    runAllTests();
  </script>
</body>
</html>
